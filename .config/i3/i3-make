#!/usr/bin/env bash

# TODO
# - Primamy monitors
# - highlight comments in config files
# - Font add font size vaiable 
# - add options for speicifing all the things
# - add configurations saver 
# - wallpapers with feh
# - tray
# - automatic ethernet detection or else

# Path to i3 config
OUT_PATH="$HOME/.config/config-git/i3/config"

# System dependant variables and main settings
TERM_COMMAND="urxvt-256color"
SPOTIFY_COMMAND="flatpak run com.spotify.Client"
DMENU_COMMAND="\"dmenu_run -nf '#F8F8F2' -nb '#282A36' -sb '#6272A4' -sf
'#F8F8F2' -fn 'monospace-12' -p 'dmenu%'\""
FONT="pango:FiraCode Nerd Font Mono 12"
LOCKER="$HOME/.config/config-git/i3/i3exit.sh"
MOD="Mod4"
LOCAL_SCRIPT="$HOME/.config/local_startup/local.sh"
WALLPAPERS="$HOME/Pictures/capture/"
BORDER_WIDTH="5"
KEYRING_COMMAND="/usr/bin/gnome-keyring-daemon --start --components=secrets"

# Temporary output file
TMP_OUT="/tmp/i3-config-tmp"

source ./i3-make-functions.sh


# ******************************************************************************
# ******************************************************************************

check_and_ask $LOCAL_SCRIPT
check_and_ask $WALLPAPERS

create_tmp $TMP_OUT


comment 'This file is generated automatically!'
comment 'Do not edit this file!'

to_i3 ""

comment "Setting varibles and machine specific things"
i3set "mod"       $MOD
i3set "lock"      $LOCKER
i3set "term"      $TERM_COMMAND
i3set "spotify"   $SPOTIFY_COMMAND
bindsym "\$mod+d" "exec ${DMENU_COMMAND}"

to_i3 ""

to_i3 "font $FONT"
to_i3 "default_border pixel $BORDER_WIDTH"
to_i3 "default_floating_border normal"
to_i3 "focus_follows_mouse no"

to_i3 ""

e_noid $LOCAL_SCRIPT
e_noid $KEYRING_COMMAND
e_noid "nm-applet"
e_noid "volumeicon"
e_noid "xss-lock --transfer-sleep-lock $LOCKER lock --nofork"
e_noid "redshift"

to_i3 ""

workspace "1" "" "Ctrl" "Shift"
workspace "2" "" "Ctrl" "Shift"
workspace "3" "" "Ctrl" "Shift"
workspace "4" "" "Ctrl" "Shift"
workspace "5" "" "Ctrl" "Shift"
workspace "6" "" "Ctrl" "Shift"
workspace "7" "Music" "Ctrl" "Shift"
workspace "8" "Mail" "Ctrl" "Shift"

to_i3 ""

movement "Left" "Down" "Up" "Right"
movement "j" "k" "l" "semicolon"

include "config_files/audio.i3"
include "config_files/app.i3"
include "config_files/bindsym.i3"
include "config_files/mode_resize.i3"
include "config_files/mode_system.i3"
include "config_files/colors.i3"
include "config_files/bar.i3"
include "config_files/gaps.i3"

info "Copying config..."
cp $TMP_OUT $OUT_PATH
clean_tmp $TMP_OUT
success "Done!"


